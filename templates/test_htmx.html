{% extends "base.html" %}

{% block content %}
<div class="container">
    <h1>HTMX Test Page</h1>
    
    <div class="test-section">
        <h2>Test Links</h2>
        <p>Click these links to test HTMX functionality:</p>
        
        <ul>
            <li><a href="{% url 'home' %}" class="category-link">Home Page</a></li>
            <li><a href="{% url 'shop:public_product_list' %}" class="category-link">Shop Page</a></li>
            <li><a href="{% url 'about' %}" class="category-link">About Page</a></li>
        </ul>
        
        <h3>Direct HTMX Test Links:</h3>
        <ul>
            <li><a href="{% url 'home' %}" 
                   hx-get="{% url 'home' %}" 
                   hx-target="#main-content" 
                   hx-swap="innerHTML">Direct HTMX Home</a></li>
            <li><a href="{% url 'about' %}" 
                   hx-get="{% url 'about' %}" 
                   hx-target="#main-content" 
                   hx-swap="innerHTML">Direct HTMX About</a></li>
        </ul>
    </div>
    
    <div class="test-section">
        <h2>Manual HTMX Test</h2>
        <button hx-get="{% url 'home' %}" hx-target="#main-content" hx-swap="innerHTML">
            Test HTMX Button
        </button>
        <button onclick="testHtmxRequest()">Test HTMX Request Manually</button>
    </div>
    
    <div class="test-section">
        <h2>Console Output</h2>
        <div id="console-output" style="background: #f5f5f5; padding: 10px; border: 1px solid #ccc; height: 300px; overflow-y: auto; font-family: monospace; font-size: 12px;"></div>
    </div>
    
    <div class="test-section">
        <h2>HTMX Status</h2>
        <div id="htmx-status"></div>
    </div>
    
    <div class="test-section">
        <h2>Link Analysis</h2>
        <div id="link-analysis"></div>
    </div>
</div>

<script>
// Override console.log to capture output
const originalLog = console.log;
const originalError = console.error;
const originalWarn = console.warn;
const consoleOutput = document.getElementById('console-output');

function addToConsole(type, args) {
    const timestamp = new Date().toLocaleTimeString();
    const color = type === 'error' ? 'red' : type === 'warn' ? 'orange' : 'green';
    consoleOutput.innerHTML += `<div style="color: ${color}; margin: 2px 0;"><strong>[${timestamp}]</strong> ${args.join(' ')}</div>`;
    consoleOutput.scrollTop = consoleOutput.scrollHeight;
}

console.log = function(...args) {
    originalLog.apply(console, args);
    addToConsole('log', args);
};

console.error = function(...args) {
    originalError.apply(console, args);
    addToConsole('error', args);
};

console.warn = function(...args) {
    originalWarn.apply(console, args);
    addToConsole('warn', args);
};

// Check HTMX status and analyze links
document.addEventListener('DOMContentLoaded', function() {
    const htmxStatus = document.getElementById('htmx-status');
    const linkAnalysis = document.getElementById('link-analysis');
    
    console.log('=== HTMX TEST PAGE LOADED ===');
    
    // Check HTMX availability
    if (typeof htmx !== 'undefined') {
        htmxStatus.innerHTML = '<div style="color: green;">✓ HTMX is loaded (version: ' + htmx.version + ')</div>';
        console.log('HTMX version:', htmx.version);
    } else {
        htmxStatus.innerHTML = '<div style="color: red;">✗ HTMX is NOT loaded</div>';
        console.error('HTMX is not available');
    }
    
    // Analyze all links
    const allLinks = document.querySelectorAll('a');
    console.log('Total links found:', allLinks.length);
    
    let linkAnalysisHtml = '<h3>Link Analysis:</h3><ul>';
    
    allLinks.forEach((link, index) => {
        const hasHtmx = link.hasAttribute('hx-get');
        const classes = link.className;
        const href = link.href;
        
        linkAnalysisHtml += `<li>Link ${index + 1}: ${href} (classes: ${classes}) - HTMX: ${hasHtmx ? 'YES' : 'NO'}</li>`;
        
        console.log(`Link ${index + 1}:`, {
            href: href,
            classes: classes,
            hasHtmx: hasHtmx,
            hxGet: link.getAttribute('hx-get'),
            hxTarget: link.getAttribute('hx-target')
        });
    });
    
    linkAnalysisHtml += '</ul>';
    linkAnalysis.innerHTML = linkAnalysisHtml;
    
    // Test HTMX functionality
    setTimeout(() => {
        console.log('Testing HTMX functionality...');
        
        // Test if HTMX is working by triggering a simple request
        if (typeof htmx !== 'undefined') {
            console.log('HTMX is available, testing...');
            
            // Test if we can make a simple HTMX request
            const testElement = document.createElement('div');
            testElement.setAttribute('hx-get', '{% url "home" %}');
            testElement.setAttribute('hx-target', '#main-content');
            testElement.setAttribute('hx-swap', 'innerHTML');
            
            console.log('Test element created:', testElement);
        }
    }, 1000);
    
    // Manual HTMX test function
    window.testHtmxRequest = function() {
        console.log('Manual HTMX test triggered');
        if (typeof htmx !== 'undefined') {
            htmx.ajax('GET', '{% url "home" %}', {
                target: '#main-content',
                swap: 'innerHTML'
            });
        } else {
            console.error('HTMX not available for manual test');
        }
    };
});

// Monitor HTMX events
document.addEventListener('htmx:beforeRequest', function(e) {
    console.log('HTMX beforeRequest:', e.detail);
    console.log('Request URL:', e.detail.path);
    console.log('Request headers:', e.detail.headers);
});

document.addEventListener('htmx:afterRequest', function(e) {
    console.log('HTMX afterRequest:', e.detail);
    console.log('Response status:', e.detail.xhr.status);
    console.log('Response headers:', e.detail.xhr.getAllResponseHeaders());
});

document.addEventListener('htmx:beforeSwap', function(e) {
    console.log('HTMX beforeSwap:', e.detail);
});

document.addEventListener('htmx:afterSwap', function(e) {
    console.log('HTMX afterSwap:', e.detail);
});

document.addEventListener('htmx:responseError', function(e) {
    console.error('HTMX responseError:', e.detail);
});

document.addEventListener('htmx:sendError', function(e) {
    console.error('HTMX sendError:', e.detail);
});

// Monitor all link clicks
document.addEventListener('click', function(e) {
    if (e.target.tagName === 'A') {
        console.log('Link clicked:', e.target.href);
        console.log('HTMX attributes:', {
            'hx-get': e.target.getAttribute('hx-get'),
            'hx-target': e.target.getAttribute('hx-target'),
            'hx-swap': e.target.getAttribute('hx-swap')
        });
    }
});
</script>

<style>
.test-section {
    margin: 20px 0;
    padding: 15px;
    border: 1px solid #ddd;
    border-radius: 5px;
}

.test-section h2 {
    margin-top: 0;
    color: #333;
}

.test-section ul {
    margin: 10px 0;
}

.test-section li {
    margin: 5px 0;
}

button {
    padding: 10px 20px;
    background: #007bff;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

button:hover {
    background: #0056b3;
}
</style>
{% endblock %} 