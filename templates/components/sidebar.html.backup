{% load i18n %}

<div class="sidebar-column">
    <!-- Shop Title Above Sidebar -->
    <div class="sidebar-title">
        <h1 class="shop-title">{{ title }}</h1>
    </div>

    <aside class="shop-sidebar">
    <!-- Category Navigation -->
    <div class="sidebar-categories">
        <h3>{% trans 'Categories' %}</h3>
        
        <ul class="category-list">
            <!-- All Products Link -->
            <li class="category-item">
                {% include 'components/htmx_link.html' with url=all_products_url text="All Products"|trans classes="category-link {% if not category %}active{% endif %}" target='#product-list-container' swap='outerHTML' push_url=False %}
            </li>
            
            <!-- Root Categories -->
            {% for root_category in sidebar_categories %}
                <li class="category-item">
                    {% include 'components/htmx_link.html' with url=root_category.get_absolute_url text=root_category.name classes="category-link {% if category and category.pk == root_category.pk %}active{% endif %}" target='#product-list-container' swap='outerHTML' push_url=False %}
                    
                    <!-- Subcategories -->
                    {% if root_category.children.all %}
                        <ul class="subcategory-list">
                            {% for subcategory in root_category.children.all|dictsort:"name" %}
                                <li class="category-item">
                                    {% include 'components/htmx_link.html' with url=subcategory.get_absolute_url text=subcategory.name classes="category-link {% if category and category.pk == subcategory.pk %}active{% endif %}" target='#product-list-container' swap='outerHTML' push_url=False %}
                                    
                                    <!-- Third level categories -->
                                    {% if subcategory.children.all %}
                                        <ul class="subcategory-list">
                                            {% for subsubcategory in subcategory.children.all|dictsort:"name" %}
                                                <li class="category-item">
                                                    {% include 'components/htmx_link.html' with url=subsubcategory.get_absolute_url text=subsubcategory.name classes="category-link {% if category and category.pk == subsubcategory.pk %}active{% endif %}" target='#product-list-container' swap='outerHTML' push_url=False %}
                                                    
                                                    {% comment %}
                                                    <!-- Removed fourth level categories for better UX and accessibility -->
                                                    <!-- Deep categories will be shown as product filters or on category pages -->
                                                    {% endcomment %}
                                                </li>
                                            {% endfor %}
                                        </ul>
                                    {% endif %}
                                </li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    </div>

    <!-- Filters Section -->
    <div class="sidebar-filters">
        <h3>{% trans 'Filters' %}</h3>
        
        <!-- Category Filter -->
        <div class="filter-section">
            <div class="category-filter-form">
                <label for="category-filter">{% trans 'Filter by Category' %}</label>
                <select id="category-filter" name="category" 
                        hx-get="{% url 'shop:public_product_list' %}"
                        hx-target="#product-list-container"
                        hx-swap="outerHTML"
                        hx-trigger="change"
                        hx-indicator="#loading-indicator"
                        hx-vals='{"view": "{{ current_view|default:'grid' }}"}'>
                    <option value="">{% trans 'All Categories' %}</option>
                    {% for cat in sidebar_categories %}
                        <option value="{{ cat.slug }}" {% if category and category.slug == cat.slug %}selected{% endif %}>
                            {{ cat.name }}
                        </option>
                        {% for subcat in cat.children.all %}
                            <option value="{{ subcat.slug }}" {% if category and category.slug == subcat.slug %}selected{% endif %}>
                                &nbsp;&nbsp;{{ subcat.name }}
                            </option>
                            {% for subsubcat in subcat.children.all %}
                                <option value="{{ subsubcat.slug }}" {% if category and category.slug == subsubcat.slug %}selected{% endif %}>
                                    &nbsp;&nbsp;&nbsp;&nbsp;{{ subsubcat.name }}
                                </option>
                            {% endfor %}
                        {% endfor %}
                    {% endfor %}
                </select>
            </div>
        </div>
    </div>
    </aside>
</div> 