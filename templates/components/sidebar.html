{% load i18n %}

<div class="sidebar-column">
    <!-- Shop Title Above Sidebar -->
    <div class="sidebar-title">
        <h1 class="shop-title">{{ title }}</h1>
    </div>

    <aside class="shop-sidebar">
    <!-- Category Navigation -->
    <div class="sidebar-categories">
        <h3>{% trans 'Categories' %}</h3>
        
        <ul class="category-list">
            <!-- All Products Link -->
            <li class="category-item">
                <a href="{% url 'shop:public_product_list' %}" 
                   class="category-link {% if not category %}active{% endif %}"
                   hx-get="{% url 'shop:public_product_list' %}"
                   hx-target="#product-list-container"
                   hx-push-url="false"
                   hx-swap="outerHTML"
                   hx-indicator="#loading-indicator">
                    {% trans 'All Products' %}
                </a>
            </li>
            
            <!-- Root Categories -->
            {% for root_category in sidebar_categories %}
                <li class="category-item">
                    <a href="{% url 'category_or_product' slug=root_category.slug %}" 
                       class="category-link {% if category and category.pk == root_category.pk %}active{% endif %}"
                       hx-get="{% url 'category_or_product' slug=root_category.slug %}"
                       hx-target="#product-list-container"
                       hx-push-url="false"
                       hx-swap="outerHTML"
                       hx-indicator="#loading-indicator">
                        {{ root_category.name }}
                    </a>
                    
                    <!-- Subcategories -->
                    {% if root_category.children.all %}
                        <ul class="subcategory-list">
                            {% for subcategory in root_category.children.all|dictsort:"name" %}
                                <li class="category-item">
                                    <a href="{% url 'category_or_product' slug=subcategory.slug %}" 
                                       class="category-link {% if category and category.pk == subcategory.pk %}active{% endif %}"
                                       hx-get="{% url 'category_or_product' slug=subcategory.slug %}"
                                       hx-target="#product-list-container"
                                       hx-push-url="false"
                                       hx-swap="outerHTML"
                                       hx-indicator="#loading-indicator">
                                        {{ subcategory.name }}
                                    </a>
                                    
                                    <!-- Third level categories -->
                                    {% if subcategory.children.all %}
                                        <ul class="subcategory-list">
                                            {% for subsubcategory in subcategory.children.all|dictsort:"name" %}
                                                <li class="category-item">
                                                    <a href="{% url 'category_or_product' slug=subsubcategory.slug %}" 
                                                       class="category-link {% if category and category.pk == subsubcategory.pk %}active{% endif %}"
                                                       hx-get="{% url 'category_or_product' slug=subsubcategory.slug %}"
                                                       hx-target="#product-list-container"
                                                       hx-push-url="false"
                                                       hx-swap="outerHTML"
                                                       hx-indicator="#loading-indicator">
                                                        {{ subsubcategory.name }}
                                                    </a>
                                                    
                                                    <!-- Fourth level categories -->
                                                    {% if subsubcategory.children.all %}
                                                        <ul class="subcategory-list">
                                                            {% for subsubsubcategory in subsubcategory.children.all|dictsort:"name" %}
                                                                <li class="category-item">
                                                                    <a href="{% url 'category_or_product' slug=subsubsubcategory.slug %}" 
                                                                       class="category-link {% if category and category.pk == subsubsubcategory.pk %}active{% endif %}"
                                                                       hx-get="{% url 'category_or_product' slug=subsubsubcategory.slug %}?view={{ current_view|default:'grid' }}"
                                                                       hx-target="#product-list-container"
                                                                       hx-push-url="true"
                                                                       hx-swap="outerHTML"
                                                                       hx-indicator="#loading-indicator"
                                                                       hx-preserve-scroll="true">
                                                                        {{ subsubsubcategory.name }}
                                                                    </a>
                                                                </li>
                                                            {% endfor %}
                                                        </ul>
                                                    {% endif %}
                                                </li>
                                            {% endfor %}
                                        </ul>
                                    {% endif %}
                                </li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    </div>

    <!-- Filters Section -->
    <div class="sidebar-filters">
        <h3>{% trans 'Filters' %}</h3>
        
        <!-- Category Filter -->
        <div class="filter-section">
            <div class="category-filter-form">
                <label for="category-filter">{% trans 'Filter by Category' %}</label>
                <select id="category-filter" name="category" 
                        hx-get="{% url 'shop:public_product_list' %}"
                        hx-target="#product-list-container"
                        hx-swap="outerHTML"
                        hx-trigger="change"
                        hx-indicator="#loading-indicator"
                        hx-vals='{"view": "{{ current_view|default:'grid' }}"}'>
                    <option value="">{% trans 'All Categories' %}</option>
                    {% for cat in sidebar_categories %}
                        <option value="{{ cat.slug }}" {% if category and category.slug == cat.slug %}selected{% endif %}>
                            {{ cat.name }}
                        </option>
                        {% for subcat in cat.children.all %}
                            <option value="{{ subcat.slug }}" {% if category and category.slug == subcat.slug %}selected{% endif %}>
                                &nbsp;&nbsp;{{ subcat.name }}
                            </option>
                            {% for subsubcat in subcat.children.all %}
                                <option value="{{ subsubcat.slug }}" {% if category and category.slug == subsubcat.slug %}selected{% endif %}>
                                    &nbsp;&nbsp;&nbsp;&nbsp;{{ subsubcat.name }}
                                </option>
                            {% endfor %}
                        {% endfor %}
                    {% endfor %}
                </select>
            </div>
        </div>
    </div>
    </aside>
</div> 